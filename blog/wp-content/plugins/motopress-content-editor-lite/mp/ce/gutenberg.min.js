(function(b){var c={$gutenberg:null,$switchModeButton:null,$goToEditorLink:null,$goToEditorButton:null,isCEMode:!1,hasPlaceholder:!1,init:function(){this.isCEMode="1"==MPCEAdmin.mpceEnabled||!0===MPCEAdmin.mpceEnabled;this.$gutenberg=b("#editor");var a=b(b("#mpce-switch-mode-html").html());this.$gutenberg.find(".edit-post-header-toolbar").append(a);this.$switchModeButton=a.find("#mpce-switch-mode-button");this.toggleStatus();this.buildPlaceholder();this.bindSwitch();wp.data.subscribe(function(){setTimeout(function(){c.buildPlaceholder()},
1)})},buildPlaceholder:function(){if(!this.hasPlaceholder){var a=b(b("#mpce-editor-placeholder-html").html());this.$gutenberg.find(".editor-block-list__layout, .editor-post-text-editor").after(a);this.hasPlaceholder=!0;this.$goToEditorLink=a.find("#mpce-go-to-editor-link");this.$goToEditorButton=a.find("#mpce-go-to-editor-button");this.$goToEditorLink.on("click",function(a){a.preventDefault();wp.data.dispatch("core/editor").savePost();c.redirectAfterSave()})}},bindSwitch:function(){var a=this;this.$switchModeButton.on("click",
function(){var b=wp.data.dispatch("core/editor");a.isCEMode?b.editPost({mpce_gutenberg_mode:!1}):(wp.data.select("core/editor").getEditedPostAttribute("title")||b.editPost({title:MPCEAdmin.noTitleLabel}),b.editPost({mpce_gutenberg_mode:!0}));a.isCEMode=!a.isCEMode;a.toggleStatus();a.isCEMode?a.$goToEditorLink.trigger("click"):b.savePost()})},redirectAfterSave:function(){this.$switchModeButton.prop("disabled",!0);this.$goToEditorLink.prop("disabled",!0);this.$goToEditorButton.addClass("disabled");
setTimeout(function(){wp.data.select("core/editor").isSavingPost()?c.redirectAfterSave():window.location.href=MPCEAdmin.editUrl},300)},toggleStatus:function(){b("body").toggleClass("mpce-mode-active",this.isCEMode).toggleClass("mpce-mode-inactive",!this.isCEMode);this.$switchModeButton.toggleClass("button-secondary",this.isCEMode).toggleClass("button-primary",!this.isCEMode)}};b(function(){setTimeout(function(){c.init()},1)})})(jQuery);
