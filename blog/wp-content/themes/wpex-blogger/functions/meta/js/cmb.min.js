jQuery(document).ready(function(e){var b;var d={};var c=0;e(".cmb_timepicker").each(function(){e("#"+jQuery(this).attr("id")).timePicker({startTime:"00:00",endTime:"23:59",show24Hours:false,separator:":",step:30});
});e(".cmb_datepicker").each(function(){e("#"+jQuery(this).attr("id")).datepicker();});e("#ui-datepicker-div").wrap('<div class="cmb_element" />');if(typeof jQuery.wp==="object"&&typeof jQuery.wp.wpColorPicker==="function"){e("input:text.cmb_colorpicker").wpColorPicker();
}else{e("input:text.cmb_colorpicker").each(function(g){e(this).after('<div id="picker-'+g+'" style="z-index: 1000; background: #EEE; border: 1px solid #CCC; position: absolute; display: block;"></div>');
e("#picker-"+g).hide().farbtastic(e(this));}).focus(function(){e(this).next().show();}).blur(function(){e(this).next().hide();});}e(".cmb_metabox").on("change",".cmb_upload_file",function(){b=e(this).attr("name");
e("#"+b+"_id").val("");}).on("click",".cmb_upload_button",function(h){h.preventDefault();var l=e(this);b=l.prev("input").attr("name");var k=e("#"+b);var g=true;
var j=true;var i=l.hasClass("cmb_upload_list");if(b in d){d[b].open();return;}d[b]=wp.media.frames.file_frame=wp.media({title:e("label[for="+b+"]").text(),button:{text:window.cmb_l10.upload_file},multiple:i?true:false});
d[b].on("select",function(){if(i){j=d[b].state().get("selection").toJSON();k.val(j.url);e("#"+b+"_id").val(j.id);var m=[];e(j).each(function(){if(this.type&&this.type==="image"){g='<li class="img_status"><img width="50" height="50" src="'+this.url+'" class="attachment-50x50" alt="'+this.filename+'"><p><a href="#" class="cmb_remove_file_button" rel="'+b+"["+this.id+']">'+cmb_l10.remove_image+'</a></p><input type="hidden" id="filelist-'+this.id+'" name="'+b+"["+this.id+']" value="'+this.url+'"></li>';
}else{g="<li>"+cmb_l10.file+" <strong>"+this.filename+'</strong>&nbsp;&nbsp;&nbsp; (<a href="'+this.url+'" target="_blank" rel="external">'+cmb_l10.download+'</a> / <a href="#" class="cmb_remove_file_button" rel="'+b+"["+this.id+']">'+cmb_l10.remove_file+'</a>)<input type="hidden" id="filelist-'+this.id+'" name="'+b+"["+this.id+']" value="'+this.url+'"></li>';
}m.push(g);});e(m).each(function(){k.siblings(".cmb_media_status").slideDown().append(this);});}else{j=d[b].state().get("selection").first().toJSON();k.val(j.url);
e("#"+b+"_id").val(j.id);if(j.type&&j.type==="image"){g='<div class="img_status"><img style="max-width: 350px; width: 100%; height: auto;" src="'+j.url+'" alt="'+j.filename+'" title="'+j.filename+'" /><p><a href="#" class="cmb_remove_file_button" rel="'+b+'">'+cmb_l10.remove_image+"</a></p></div>";
}else{g=cmb_l10.file+" <strong>"+j.filename+'</strong>&nbsp;&nbsp;&nbsp; (<a href="'+j.url+'" target="_blank" rel="external">'+cmb_l10.download+'</a> / <a href="#" class="cmb_remove_file_button" rel="'+b+'">'+cmb_l10.remove_file+"</a>)";
}k.siblings(".cmb_media_status").slideDown().html(g);}});d[b].open();}).on("click",".cmb_remove_file_button",function(g){var i=e(this);if(i.is(".attach_list .cmb_remove_file_button")){i.parents("li").remove();
return false;}b=i.attr("rel");var h=i.parents(".img_status");e("input#"+b).val("");e("input#"+b+"_id").val("");if(!h.length){i.parents(".cmb_media_status").html("");
}else{h.html("");}return false;}).on("click",".add-row-button",function(j){j.preventDefault();self=e(this);var i="#"+self.data("selector");var h=e(i);var k=e(".empty-row",h).clone(true);
k.removeClass("empty-row").addClass("repeat-row");k.insertBefore(i+" tbody>tr:last");var g=e("input.cmb_datepicker",k);var l=g.attr("id");g.attr("id",l+c);
c++;}).on("click",".remove-row-button",function(h){h.preventDefault();var i=e(this);var g=i.parents(".cmb-repeat-table");console.log("number of tbodys",g.length);
console.log("number of trs",e("tr",g).length);if(e("tr",g).length>2){i.parents(".cmb-repeat-table tr").remove();}}).on("keyup",".cmb_oembed",function(g){f(e(this),g);
});e(".cmb_oembed").bind("paste",function(h){var g=e(this);setTimeout(function(){f(g,"paste");},100);}).blur(function(){setTimeout(function(){e(".postbox table.cmb_metabox .cmb-spinner").hide();
},2000);});function f(n,m){var i=n.val();if(i.length<6){return;}if(m==="paste"||m.which<=90&&m.which>=48||m.which>=96&&m.which<=111||m.which==8||m.which==9||m.which==187||m.which==190){var k=n.attr("id");
var h=n.parents(".cmb_metabox tr td");var l=e(".embed_status",h);var g=n.width();var j=e(":first-child",l);g=(l.length&&j.length)?j.width():n.width();e(".cmb-spinner",h).show();
e(".embed_wrap",h).html("");setTimeout(function(){if(e(".cmb_oembed:focus").val()!=i){return;}e.ajax({type:"post",dataType:"json",url:window.cmb_l10.ajaxurl,data:{action:"cmb_oembed_handler",oembed_url:i,oembed_width:g>300?g:300,field_id:k,object_id:window.cmb_l10.object_id,object_type:window.cmb_l10.object_type,cmb_ajax_nonce:window.cmb_l10.ajax_nonce},success:function(o){if(typeof o.id==="undefined"){return;
}e(".cmb-spinner",h).hide();e(".embed_wrap",h).html(o.result);}});},500);}}function a(){e("table.cmb_metabox").each(function(l){var o=e(this);var n=o.parents(".inside");
if(!n.length){return true;}var k=n.width();var j=Math.round((k*0.82)*0.97)-30;if(j>639){return true;}var h=e(".cmb-type-oembed .embed_status",o).children().first();
var i=h.width();var m=h.height();var g=Math.round((j*m)/i);h.width(j).height(g);});}setTimeout(a,500);e(window).on("resize",a);});